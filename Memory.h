#include "Screen.h"

const unsigned char FontSet[80] = {
	0xF0, 0x90, 0x90, 0x90, 0xF0,		// 0
	0x20, 0x60, 0x20, 0x20, 0x70,		// 1
	0xF0, 0x10, 0xF0, 0x80, 0xF0,		// 2
	0xF0, 0x10, 0xF0, 0x10, 0xF0,		// 3
	0x90, 0x90, 0xF0, 0x10, 0x10,		// 4
	0xF0, 0x80, 0xF0, 0x10, 0xF0,		// 5
	0xF0, 0x80, 0xF0, 0x90, 0xF0,		// 6
	0xF0, 0x10, 0x20, 0x40, 0x40,		// 7
	0xF0, 0x90, 0xF0, 0x90, 0xF0,		// 8
	0xF0, 0x90, 0xF0, 0x10, 0xF0,		// 9
	0xF0, 0x90, 0xF0, 0x90, 0x90,		// A
	0xE0, 0x90, 0xE0, 0x90, 0xE0,		// B
	0xF0, 0x80, 0x80, 0x80, 0xF0,		// C
	0xE0, 0x90, 0x90, 0x90, 0xE0,		// D
	0xF0, 0x80, 0xF0, 0x80, 0xF0,		// E
	0xF0, 0x80, 0xF0, 0x80, 0x80		// F
};

void LoadRom(const char *Path){
	SDFile* Rom = NULL;
	int FileSize = 0;
	
	Rom = pd->file->open(Path, kFileRead);

	pd->file->seek(Rom, 0, SEEK_END);
	FileSize = pd->file->tell(Rom);
    pd->file->seek(Rom, 0, SEEK_SET);

	pd->file->read(Rom, SystemMemory + 0x200, FileSize);

	if (Rom != NULL){
		pd->system->logToConsole("Loaded Rom Successfully");
	}
	else {
		return 0;
	}
	
	pd->file->close(Rom);

	RomLoaded = true;
}


auto InitMemory(){
	memset(SystemMemory , 0 , sizeof(SystemMemory));
	memset(SystemStack , 0 , sizeof(SystemStack));
	memset(SystemRegisters , 0 , sizeof(SystemRegisters));
    SystemIRegister = 0x00;
    SystemProgramCounter = 0x200;
	SystemKey = 0;

    for (int i = 0; i < 80; i++) {
		SystemMemory[i] = FontSet[i];
	}
}

